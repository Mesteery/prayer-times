"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function _iterableToArrayLimit(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var a=[],i=!0,r=!1,n=void 0;try{for(var s,h=t[Symbol.iterator]();!(i=(s=h.next()).done)&&(a.push(s.value),!e||a.length!==e);i=!0);}catch(t){r=!0,n=t}finally{try{i||null==h.return||h.return()}finally{if(r)throw n}}return a}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var DMath={dtr:function(t){return t*Math.PI/180},rtd:function(t){return 180*t/Math.PI},sin:function(t){return Math.sin(this.dtr(t))},cos:function(t){return Math.cos(this.dtr(t))},tan:function(t){return Math.tan(this.dtr(t))},arcsin:function(t){return this.rtd(Math.asin(t))},arccos:function(t){return this.rtd(Math.acos(t))},arctan:function(t){return this.rtd(Math.atan(t))},arccot:function(t){return this.rtd(Math.atan(1/t))},arctan2:function(t,e){return this.rtd(Math.atan2(t,e))},fixAngle:function(t){return this.fix(t,360)},fixHour:function(t){return this.fix(t,24)},fix:function(t,e){return(t-=e*Math.floor(t/e))<0?t+e:t}},Prayer=function t(e,a,i){_classCallCheck(this,t),this.name=e,this.date=a,this.formatted=i};_defineProperty(Prayer,"TimeNames",{imsak:"Imsak",fajr:"Fajr",sunrise:"Sunrise",dhuhr:"Dhuhr",asr:"Asr",sunset:"Sunset",maghrib:"Maghrib",isha:"Isha",midnight:"Midnight"});var PrayerManager=function(){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"MWL";for(var e in _classCallCheck(this,r),this._method=t,this.methods={MWL:{name:"Muslim World League",params:{fajr:18,isha:17}},ISNA:{name:"Islamic Society of North America (ISNA)",params:{fajr:15,isha:15}},MF:{name:"Muslims of France (MF)",params:{fajr:12,isha:12}},Egypt:{name:"Egyptian General Authority of Survey",params:{fajr:19.5,isha:17.5}},Makkah:{name:"Umm Al-Qura University, Makkah",params:{fajr:18.5,isha:"90 min"}},Karachi:{name:"University of Islamic Sciences, Karachi",params:{fajr:18,isha:18}},Tehran:{name:"Institute of Geophysics, University of Tehran",params:{fajr:17.7,isha:14,maghrib:4.5,midnight:"Jafari"}},Jafari:{name:"Shia Ithna-Ashari, Leva Institute, Qum",params:{fajr:16,isha:14,maghrib:4,midnight:"Jafari"}},JAKIM:{name:"Jabatan Kemajuan Islam Malaysia",params:{fajr:20,isha:18}}},this.defaultParams={maghrib:"0 min",midnight:"Standard"},this.setting={imsak:"10 min",dhuhr:"0 min",asr:"Standard",highLats:"NightMiddle"},this.timeFormat="24h",this.timeSuffixes=["am","pm"],this.invalidTime="---",this.numIterations=1,this.offset={},this.lat,this.lng,this.elv,this.timeZone,this.jDate,this.defParams=this.defaultParams,this.methods)for(var a in this.params=this.methods[e].params,this.defParams)void 0===this.params[a]&&(this.params[a]=this.defParams[a]);for(var i in this.calcMethod=this.methods[t]?t:"MWL",this.params=this.methods[this.calcMethod].params,this.adjust(this.params),Prayer.TimeNames)this.offset[i]=0}return _createClass(r,[{key:"adjust",value:function(t){for(var e in t)this.setting[e]=t[e]}},{key:"tune",value:function(t){for(var e in t)this.offset[e]=t[e]}},{key:"getSetting",value:function(){return this.setting}},{key:"getOffsets",value:function(){return this.offset}},{key:"getDefaults",value:function(){return this.methods}},{key:"getTimes",value:function(t,e,a,i,r){var n=0<arguments.length&&void 0!==t?t:new Date,s=1<arguments.length?e:void 0,h=2<arguments.length&&void 0!==a?a:"auto",o=3<arguments.length&&void 0!==i?i:"auto",u=4<arguments.length&&void 0!==r?r:"24h";return this.lat=Number(s[0]),this.lng=Number(s[1]),this.elv=s[2]?Number(s[2]):0,this.timeFormat=u||this.timeFormat,"number"==typeof n&&(n=new Date(n)),n instanceof Date&&(n=[n.getFullYear(),n.getMonth()+1,n.getDate()]),"auto"===h&&(h=this.getTimeZone(n)),"auto"===o&&(o=this.getDst(n)),this.timeZone=Number(h)+(Number(o)?1:0),this.jDate=this.julian(n[0],n[1],n[2])-this.lng/360,this.computeTimes(n)}},{key:"getMonthTimes",value:function(t,a,i,r,n){var s=this,e=_slicedToArray(t,2),h=e[0],o=e[1],h=Number(h),o=Number(o);return _toConsumableArray(Array(new Date(h,o,0).getDate())).map(function(t,e){return s.getTimes(new Date(h,o,e+1),a,i,r,n)})}},{key:"getYearTimes",value:function(a,i,r,n,s){var h=this;if("number"!=typeof a)throw new Error("The year argument must be a number");return _toConsumableArray(Array(12)).map(function(t,e){return h.getMonthTimes([a,e+1],i,r,n,s)})}},{key:"getFormattedTime",value:function(t,e,a){if(isNaN(t))return this.invalidTime;if("Float"===e)return t;a=a||this.timeSuffixes,t=DMath.fixHour(t+.5/60);var i=Math.floor(t),r=Math.floor(60*(t-i)),n="12h"===e?a[i<12?0:1]:"";return("24h"===e?this.twoDigitsFormat(i):(i+12-1)%12+1)+":"+this.twoDigitsFormat(r)+(n?" "+n:"")}},{key:"midDay",value:function(t){var e=this.sunPosition(this.jDate+t).equation;return DMath.fixHour(12-e)}},{key:"sunAngleTime",value:function(t,e,a){var i=this.sunPosition(this.jDate+e).declination,r=this.midDay(e),n=1/15*DMath.arccos((-DMath.sin(t)-DMath.sin(i)*DMath.sin(this.lat))/(DMath.cos(i)*DMath.cos(this.lat)));return r+("ccw"===a?-n:n)}},{key:"asrTime",value:function(t,e){var a=this.sunPosition(this.jDate+e).declination,i=-DMath.arccot(t+DMath.tan(Math.abs(this.lat-a)));return this.sunAngleTime(i,e)}},{key:"sunPosition",value:function(t){var e=t-2451545,a=DMath.fixAngle(357.529+.98560028*e),i=DMath.fixAngle(280.459+.98564736*e),r=DMath.fixAngle(i+1.915*DMath.sin(a)+.02*DMath.sin(2*a)),n=(DMath.cos(a),DMath.cos(2*a),23.439-36e-8*e),s=DMath.arctan2(DMath.cos(n)*DMath.sin(r),DMath.cos(r))/15,h=i/15-DMath.fixHour(s);return{declination:DMath.arcsin(DMath.sin(n)*DMath.sin(r)),equation:h}}},{key:"julian",value:function(t,e,a){e<=2&&(--t,e+=12);var i=Math.floor(t/100),r=2-i+Math.floor(i/4);return Math.floor(365.25*(t+4716))+Math.floor(30.6001*(e+1))+a+r-1524.5}},{key:"computePrayerTimes",value:function(t){t=this.dayPortion(t);var e=this.setting;return{imsak:this.sunAngleTime(this.eval(e.imsak),t.imsak,"ccw"),fajr:this.sunAngleTime(this.eval(e.fajr),t.fajr,"ccw"),sunrise:this.sunAngleTime(this.riseSetAngle(),t.sunrise,"ccw"),dhuhr:this.midDay(t.dhuhr),asr:this.asrTime(this.asrFactor(e.asr),t.asr),sunset:this.sunAngleTime(this.riseSetAngle(),t.sunset),maghrib:this.sunAngleTime(this.eval(e.maghrib),t.maghrib),isha:this.sunAngleTime(this.eval(e.isha),t.isha)}}},{key:"computeTimes",value:function(t){for(var e={imsak:5,fajr:5,sunrise:6,dhuhr:12,asr:13,sunset:18,maghrib:18,isha:18},a=1;a<=this.numIterations;a++)e=this.computePrayerTimes(e);return(e=this.adjustTimes(e)).midnight="Jafari"===this.setting.midnight?e.sunset+this.timeDiff(e.sunset,e.fajr)/2:e.sunset+this.timeDiff(e.sunset,e.sunrise)/2,e=this.tuneTimes(e),this.modifyFormats(e,t)}},{key:"adjustTimes",value:function(t){var e=this.setting;for(var a in t)t[a]+=this.timeZone-this.lng/15;return"None"!==e.highLats&&(t=this.adjustHighLats(t)),this.isMin(e.imsak)&&(t.imsak=t.fajr-this.eval(e.imsak)/60),this.isMin(e.maghrib)&&(t.maghrib=t.sunset+this.eval(e.maghrib)/60),this.isMin(e.isha)&&(t.isha=t.maghrib+this.eval(e.isha)/60),t.dhuhr+=this.eval(e.dhuhr)/60,t}},{key:"asrFactor",value:function(t){return{Standard:1,Hanafi:2}[t]||this.eval(t)}},{key:"riseSetAngle",value:function(){return.833+.0347*Math.sqrt(this.elv)}},{key:"tuneTimes",value:function(t){for(var e in t)t[e]+=this.offset[e]/60;return t}},{key:"modifyFormats",value:function(t,e){var a=_slicedToArray(e,3),i=a[0],r=a[1],n=a[2],s=[];for(var h in t){var o,u,m=this.getFormattedTime(t[h],this.timeFormat);m===this.invalidTime?s.push(new Prayer(h,null,m)):(o=DMath.fixHour(t[h]+.5/60),u=Math.floor(o),s.push(new Prayer(h,new Date(i,r-1,n,u,Math.floor(60*(o-u)),0,0),m)))}return s}},{key:"adjustHighLats",value:function(t){var e=this.setting,a=this.timeDiff(t.sunset,t.sunrise);return t.imsak=this.adjustHLTime(t.imsak,t.sunrise,this.eval(e.imsak),a,"ccw"),t.fajr=this.adjustHLTime(t.fajr,t.sunrise,this.eval(e.fajr),a,"ccw"),t.isha=this.adjustHLTime(t.isha,t.sunset,this.eval(e.isha),a),t.maghrib=this.adjustHLTime(t.maghrib,t.sunset,this.eval(e.maghrib),a),t}},{key:"adjustHLTime",value:function(t,e,a,i,r){var n=this.nightPortion(a,i),s="ccw"==r?this.timeDiff(t,e):this.timeDiff(e,t);return(isNaN(t)||n<s)&&(t=e+("ccw"==r?-n:n)),t}},{key:"nightPortion",value:function(t,e){var a=this.setting.highLats;return("OneSeventh"==a?1/7:"AngleBased"==a?1/60*t:.5)*e}},{key:"dayPortion",value:function(t){for(var e in t)t[e]/=24;return t}},{key:"getTimeZone",value:function(t){var e=t[0],a=this.gmtOffset([e,0,1]),i=this.gmtOffset([e,6,1]);return Math.min(a,i)}},{key:"getDst",value:function(t){return Number(this.gmtOffset(t)!=this.getTimeZone(t))}},{key:"gmtOffset",value:function(t){var e=new Date(t[0],t[1]-1,t[2],12,0,0,0),a=e.toGMTString();return(e-new Date(a.substring(0,a.lastIndexOf(" ")-1)))/36e5}},{key:"eval",value:function(t){return Number(String(t).split(/[^0-9.+-]/)[0])}},{key:"isMin",value:function(t){return-1!==String(t).indexOf("min")}},{key:"timeDiff",value:function(t,e){return DMath.fixHour(e-t)}},{key:"twoDigitsFormat",value:function(t){return t<10?"0"+t:t}},{key:"method",set:function(t){if(!this.methods[String(t)])throw new Error("The method "+t+" doesn't exists");this.adjust(this.methods[t].params),this.calcMethod=t},get:function(){return this.calcMethod}}]),r}();"undefined"!=typeof module&&void 0!==module.exports?module.exports={PrayerManager:PrayerManager,Prayer:Prayer}:"function"==typeof define&&define.amd?define([],function(){return{PrayerManager:PrayerManager,Prayer:Prayer}}):window.PrayerTimes={PrayerManager:PrayerManager,Prayer:Prayer};