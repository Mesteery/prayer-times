"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function _iterableToArrayLimit(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var i=[],a=!0,r=!1,n=void 0;try{for(var s,h=t[Symbol.iterator]();!(a=(s=h.next()).done)&&(i.push(s.value),!e||i.length!==e);a=!0);}catch(t){r=!0,n=t}finally{try{a||null==h.return||h.return()}finally{if(r)throw n}}return i}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var DMath={dtr:function(t){return t*Math.PI/180},rtd:function(t){return 180*t/Math.PI},sin:function(t){return Math.sin(this.dtr(t))},cos:function(t){return Math.cos(this.dtr(t))},tan:function(t){return Math.tan(this.dtr(t))},arcsin:function(t){return this.rtd(Math.asin(t))},arccos:function(t){return this.rtd(Math.acos(t))},arctan:function(t){return this.rtd(Math.atan(t))},arccot:function(t){return this.rtd(Math.atan(1/t))},arctan2:function(t,e){return this.rtd(Math.atan2(t,e))},fixAngle:function(t){return this.fix(t,360)},fixHour:function(t){return this.fix(t,24)},fix:function(t,e){return(t-=e*Math.floor(t/e))<0?t+e:t}},Prayer=function t(e,i,a){_classCallCheck(this,t),this.name=e,this.date=i,this.formatted=a};_defineProperty(Prayer,"TimeNames",{imsak:"Imsak",fajr:"Fajr",sunrise:"Sunrise",dhuhr:"Dhuhr",asr:"Asr",sunset:"Sunset",maghrib:"Maghrib",isha:"Isha",midnight:"Midnight"});var PrayerManager=function(){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"MWL";for(var e in _classCallCheck(this,r),this._method=t,this.methods={MWL:{name:"Muslim World League",params:{fajr:18,isha:17}},ISNA:{name:"Islamic Society of North America (ISNA)",params:{fajr:15,isha:15}},MF:{name:"Muslims of France (MF)",params:{fajr:12,isha:12}},Egypt:{name:"Egyptian General Authority of Survey",params:{fajr:19.5,isha:17.5}},Makkah:{name:"Umm Al-Qura University, Makkah",params:{fajr:18.5,isha:"90 min"}},Karachi:{name:"University of Islamic Sciences, Karachi",params:{fajr:18,isha:18}},Tehran:{name:"Institute of Geophysics, University of Tehran",params:{fajr:17.7,isha:14,maghrib:4.5,midnight:"Jafari"}},Jafari:{name:"Shia Ithna-Ashari, Leva Institute, Qum",params:{fajr:16,isha:14,maghrib:4,midnight:"Jafari"}},JAKIM:{name:"Jabatan Kemajuan Islam Malaysia",params:{fajr:20,isha:18}}},this.defaultParams={maghrib:"0 min",midnight:"Standard"},this.setting={imsak:"10 min",dhuhr:"0 min",asr:"Standard",highLats:"NightMiddle"},this.timeFormat="24h",this.timeSuffixes=["am","pm"],this.invalidTime="---",this.numIterations=1,this.offset={},this.lat,this.lng,this.elv,this.timeZone,this.jDate,this.defParams=this.defaultParams,this.methods)for(var i in this.params=this.methods[e],this.defParams)void 0===this.params[i]&&(this.params[i]=this.defParams[i]);for(var a in this.calcMethod=this.methods[t]?t:"MWL",this.params=this.methods[this.calcMethod].params,this.adjust(this.parms),Prayer.TimeNames)this.offset[a]=0}return _createClass(r,[{key:"adjust",value:function(t){for(var e in t)this.setting[e]=t[e]}},{key:"tune",value:function(t){for(var e in t)this.offset[e]=t[e]}},{key:"getSetting",value:function(){return this.setting}},{key:"getOffsets",value:function(){return this.offset}},{key:"getDefaults",value:function(){return this.methods}},{key:"getTimes",value:function(t,e,i,a,r){var n=0<arguments.length&&void 0!==t?t:new Date,s=1<arguments.length?e:void 0,h=2<arguments.length&&void 0!==i?i:"auto",o=3<arguments.length&&void 0!==a?a:"auto",u=4<arguments.length&&void 0!==r?r:"24h";return this.lat=Number(s[0]),this.lng=Number(s[1]),this.elv=s[2]?Number(s[2]):0,this.timeFormat=u||this.timeFormat,"number"==typeof n&&(n=new Date(n)),n instanceof Date&&(n=[n.getFullYear(),n.getMonth()+1,n.getDate()]),"auto"===h&&(h=this.getTimeZone(n)),"auto"===o&&(o=this.getDst(n)),this.timeZone=Number(h)+(Number(o)?1:0),this.jDate=this.julian(n[0],n[1],n[2])-this.lng/360,this.computeTimes(n)}},{key:"getMonthTimes",value:function(t,i,a,r,n){var s=this,e=_slicedToArray(t,2),h=e[0],o=e[1],h=Number(h),o=Number(o);return _toConsumableArray(Array(new Date(h,o,0).getDate())).map(function(t,e){return s.getTimes(new Date(h,o,e+1),i,a,r,n)})}},{key:"getYearTimes",value:function(i,a,r,n,s){var h=this;if("number"!=typeof i)throw new Error("The year argument must be a number");return _toConsumableArray(Array(12)).map(function(t,e){return h.getMonthTimes([i,e+1],a,r,n,s)})}},{key:"getFormattedTime",value:function(t,e,i){if(isNaN(t))return this.invalidTime;if("Float"===e)return t;i=i||this.timeSuffixes,t=DMath.fixHour(t+.5/60);var a=Math.floor(t),r=Math.floor(60*(t-a)),n="12h"===e?i[a<12?0:1]:"";return("24h"===e?this.twoDigitsFormat(a):(a+12-1)%12+1)+":"+this.twoDigitsFormat(r)+(n?" "+n:"")}},{key:"midDay",value:function(t){var e=this.sunPosition(this.jDate+t).equation;return DMath.fixHour(12-e)}},{key:"sunAngleTime",value:function(t,e,i){var a=this.sunPosition(this.jDate+e).declination,r=this.midDay(e),n=1/15*DMath.arccos((-DMath.sin(t)-DMath.sin(a)*DMath.sin(this.lat))/(DMath.cos(a)*DMath.cos(this.lat)));return r+("ccw"===i?-n:n)}},{key:"asrTime",value:function(t,e){var i=this.sunPosition(this.jDate+e).declination,a=-DMath.arccot(t+DMath.tan(Math.abs(this.lat-i)));return this.sunAngleTime(a,e)}},{key:"sunPosition",value:function(t){var e=t-2451545,i=DMath.fixAngle(357.529+.98560028*e),a=DMath.fixAngle(280.459+.98564736*e),r=DMath.fixAngle(a+1.915*DMath.sin(i)+.02*DMath.sin(2*i)),n=(DMath.cos(i),DMath.cos(2*i),23.439-36e-8*e),s=DMath.arctan2(DMath.cos(n)*DMath.sin(r),DMath.cos(r))/15,h=a/15-DMath.fixHour(s);return{declination:DMath.arcsin(DMath.sin(n)*DMath.sin(r)),equation:h}}},{key:"julian",value:function(t,e,i){e<=2&&(--t,e+=12);var a=Math.floor(t/100),r=2-a+Math.floor(a/4);return Math.floor(365.25*(t+4716))+Math.floor(30.6001*(e+1))+i+r-1524.5}},{key:"computePrayerTimes",value:function(t){t=this.dayPortion(t);var e=this.setting;return{imsak:this.sunAngleTime(this.eval(e.imsak),t.imsak,"ccw"),fajr:this.sunAngleTime(this.eval(e.fajr),t.fajr,"ccw"),sunrise:this.sunAngleTime(this.riseSetAngle(),t.sunrise,"ccw"),dhuhr:this.midDay(t.dhuhr),asr:this.asrTime(this.asrFactor(e.asr),t.asr),sunset:this.sunAngleTime(this.riseSetAngle(),t.sunset),maghrib:this.sunAngleTime(this.eval(e.maghrib),t.maghrib),isha:this.sunAngleTime(this.eval(e.isha),t.isha)}}},{key:"computeTimes",value:function(t){for(var e={imsak:5,fajr:5,sunrise:6,dhuhr:12,asr:13,sunset:18,maghrib:18,isha:18},i=1;i<=this.numIterations;i++)e=this.computePrayerTimes(e),(e=this.adjustTimes(e)).midnight="Jafari"==this.setting.midnight?e.sunset+this.timeDiff(e.sunset,e.fajr)/2:e.sunset+this.timeDiff(e.sunset,e.sunrise)/2;return e=this.tuneTimes(e),this.modifyFormats(e,t)}},{key:"adjustTimes",value:function(t){var e=this.setting;for(var i in t)t[i]+=this.timeZone-this.lng/15;return"None"!==e.highLats&&(t=this.adjustHighLats(t)),this.isMin(e.imsak)&&(t.imsak=t.fajr-this.eval(e.imsak)/60),this.isMin(e.maghrib)&&(t.maghrib=t.sunset+this.eval(e.maghrib)/60),this.isMin(e.isha)&&(t.isha=t.maghrib+this.eval(e.isha)/60),t.dhuhr+=this.eval(e.dhuhr)/60,t}},{key:"asrFactor",value:function(t){return{Standard:1,Hanafi:2}[t]||this.eval(t)}},{key:"riseSetAngle",value:function(){return.833+.0347*Math.sqrt(this.elv)}},{key:"tuneTimes",value:function(t){for(var e in t)t[e]+=this.offset[e]/60;return t}},{key:"modifyFormats",value:function(t,e){var i=_slicedToArray(e,3),a=i[0],r=i[1],n=i[2],s=[];for(var h in t){var o,u,m=this.getFormattedTime(t[h],this.timeFormat);m===this.invalidTime?s.push(new Prayer(h,null,m)):(o=DMath.fixHour(t[h]+.5/60),u=Math.floor(o),s.push(new Prayer(h,new Date(a,r,n,u,Math.floor(60*(o-u)),0,0),m)))}return s}},{key:"adjustHighLats",value:function(t){var e=this.setting,i=this.timeDiff(t.sunset,t.sunrise);return t.imsak=this.adjustHLTime(t.imsak,t.sunrise,this.eval(e.imsak),i,"ccw"),t.fajr=this.adjustHLTime(t.fajr,t.sunrise,this.eval(e.fajr),i,"ccw"),t.isha=this.adjustHLTime(t.isha,t.sunset,this.eval(e.isha),i),t.maghrib=this.adjustHLTime(t.maghrib,t.sunset,this.eval(e.maghrib),i),t}},{key:"adjustHLTime",value:function(t,e,i,a,r){var n=this.nightPortion(i,a),s="ccw"==r?this.timeDiff(t,e):this.timeDiff(e,t);return(isNaN(t)||n<s)&&(t=e+("ccw"==r?-n:n)),t}},{key:"nightPortion",value:function(t,e){var i=this.setting.highLats;return("OneSeventh"==i?1/7:"AngleBased"==i?1/60*t:.5)*e}},{key:"dayPortion",value:function(t){for(var e in t)t[e]/=24;return t}},{key:"getTimeZone",value:function(t){var e=t[0],i=this.gmtOffset([e,0,1]),a=this.gmtOffset([e,6,1]);return Math.min(i,a)}},{key:"getDst",value:function(t){return Number(this.gmtOffset(t)!=this.getTimeZone(t))}},{key:"gmtOffset",value:function(t){var e=new Date(t[0],t[1]-1,t[2],12,0,0,0),i=e.toGMTString();return(e-new Date(i.substring(0,i.lastIndexOf(" ")-1)))/36e5}},{key:"eval",value:function(t){return Number(String(t).split(/[^0-9.+-]/)[0])}},{key:"isMin",value:function(t){return-1!==String(t).indexOf("min")}},{key:"timeDiff",value:function(t,e){return DMath.fixHour(e-t)}},{key:"twoDigitsFormat",value:function(t){return t<10?"0"+t:t}},{key:"method",set:function(t){if(!this.methods[String(t)])throw new Error("The method "+t+" doesn't exists");this.adjust(this.methods[t].params),this.calcMethod=t},get:function(){return this.calcMethod}}]),r}();"undefined"!=typeof module&&void 0!==module.exports?module.exports={PrayerManager:PrayerManager,Prayer:Prayer}:"function"==typeof define&&define.amd?define([],function(){return{PrayerManager:PrayerManager,Prayer:Prayer}}):window.PrayerTimes={PrayerManager:PrayerManager,Prayer:Prayer};